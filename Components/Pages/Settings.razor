@page "/settings"
@using JournalEntryManagement.Services
@inject JournalService JournalService
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime

<PageTitle>Settings</PageTitle>

<div class="container fade-in">
    <h2 class="mb-4" style="color: var(--primary-color);">Settings</h2>

    <div class="pro-card mb-4">
        <h5 class="fw-bold mb-3">Export Data</h5>
        <p class="text-muted">Save your journal entries as a PDF document.</p>
        <button class="btn btn-outline-dark w-100" @onclick="ExportPdf">📄 Export to PDF</button>
    </div>

    <div class="pro-card mb-4 border-danger" style="border: 1px solid #ffcccc;">
        <h5 class="fw-bold text-danger mb-3">Danger Zone</h5>
        <button class="btn btn-danger w-100" @onclick="DeleteAllData">
            🗑️ Delete All Journal Entries
        </button>
    </div>
</div>

@code {
    private async Task ExportPdf()
    {
        // Triggers the browser Print dialog -> Save as PDF
        await JSRuntime.InvokeVoidAsync("printPage");
    }

    private async Task DeleteAllData()
    {
        bool confirm = await Application.Current.MainPage.DisplayAlert("Reset?", "Delete ALL memories?", "Yes", "Cancel");
        if (confirm) {
            await JournalService.DeleteAllEntriesAsync();
            NavigationManager.NavigateTo("/", forceLoad: true);
        }
    }
}