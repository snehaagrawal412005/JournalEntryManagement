@page "/"
@using JournalEntryManagement.Services
@using JournalEntryManagement.Models
@inject JournalService JournalService

<PageTitle>Dashboard</PageTitle>

<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h2 style="color: var(--primary-color);">Welcome Back!</h2>
            <p class="text-muted">Here is your journaling overview.</p>
        </div>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="pro-card stat-widget">
                <div class="stat-number">@CurrentStreak 🔥</div>
                <div class="stat-label">Day Streak</div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="pro-card stat-widget">
                <div class="stat-number">@TotalEntries 📖</div>
                <div class="stat-label">Total Memories</div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="pro-card stat-widget" style="@(WrittenToday ? "border: 2px solid #00897b;" : "")">
                <div class="stat-number">@(WrittenToday ? "Done" : "Pending")</div>
                <div class="stat-label">Today's Entry</div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12 text-center">
            @if (!WrittenToday)
            {
                <a href="write" class="btn btn-primary btn-lg shadow">
                    Write Today's Story &rarr;
                </a>
            }
            else
            {
                <div class="alert alert-success">
                    You have completed your journal for today. Good job!
                    <br/>
                    <a href="write" class="alert-link">Edit Today's Entry</a>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private int CurrentStreak = 0;
    private int TotalEntries = 0;
    private bool WrittenToday = false;

    protected override async Task OnInitializedAsync()
    {
        // Getting total count
        var allEntries = await JournalService.GetAllEntriesAsync();
        TotalEntries = allEntries.Count;

        // Checking if written today
        var today = await JournalService.GetEntryByDateAsync(DateTime.Today);
        WrittenToday = today != null;

        // Calculating Streak
        CurrentStreak = await JournalService.CalculateStreak();
    }
}